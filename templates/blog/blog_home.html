{% extends 'base.html' %}
{% load static %}
{# Django HTML Template - CSS validation disabled for template syntax #}

{% block page_title %}
Blog
{% endblock %}

{% block content %}
<main>
      <!-- Header start -->
      <section class="mt-8" data-cue="fadeIn">
         <div class="container">
            <a href="#!">
               <div class="py-lg-10 rounded-3 px-lg-8 py-md-8 px-md-6 p-4 image-blur"
                  style="background-image: url('{% static "assets/images/landings/agency/agency-hero-img.jpg" %}'); background-position: center; background-repeat: no-repeat; background-size: cover;">
                  <div class="row g-0">
                     <div class="col-xxl-6 col-xl-7 col-lg-8">
                        <div class="d-flex flex-column gap-10" data-cue="zoomIn">
                           <div>
                              <span
                                 class="badge border border-white text-white-stable px-3 py-2 fw-medium rounded-pill fs-6">Blog</span>
                           </div>
                           <div class="d-flex flex-column gap-6">
                              <div class="d-flex flex-column gap-3">
                                 <h1 class="mb-0 text-white-stable">The Code Feed & Fresh Finds
                                 </h1>
                                 <p class="mb-0 text-white-stable">
                                    Serving up the freshest programming ingredients from across the web. Where APIs are the main course, Python is the secret sauce, and every tutorial is a recipe for digital success. Warning: may contain traces of caffeine and existential debugging sessions.
                                 </p>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
            </a>
         </div>
      </section>
      <!-- Header end -->

      <!-- Blog Posts START -->
      <section class="mb-xl-9 mb-5 my-8" data-cue="fadeIn">
         <div class="container">
            <div class="row gy-5 gy-lg-0">

               <div class="col-xxl-9 col-lg-8 col-12">
                  <div class="row g-5">
                  {% for post in page_obj %}

                     <div class="col-xxl-6 col-12" data-cue="fadeIn">
                        <a href="{% url 'blog_post' post.slug %}">
                           <div class="rounded-3 p-4 image-blur" style="
                                    background: linear-gradient(180deg, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0) 10%, rgba(0, 0, 0, 0.8) 100%), url({{ post.featured_image.url }});
                                    background-position: center;
                                    background-repeat: no-repeat;
                                    background-size: cover;
                                 ">
                              <div class="d-flex flex-column gap-10" data-cue="zoomOut">
                                 <div>
                                    {% for category in post.categories.all|slice:':4' %}
                                    <span
                                       class="badge border rounded-pill border-white text-white-stable px-3 py-2 fw-medium fs-6">{{category}}</span>
                                 {% endfor %}
                                 </div>

                                 <div class="d-flex flex-column gap-4">
                                    <div class="d-flex flex-column gap-1">
                                       <h3 class="mb-0 text-white-stable text-truncate">{{ post.title }}</h3>
                                       <p class="mb-0 text-white-stable text-truncate">
                                          {{ post.excerpt|truncatechars:50 }}
                                       </p>
                                    </div>
                                    <div class="d-flex align-items-center align-items-center gap-3">
                                       <div class="d-flex flex-row align-items-center gap-2">
                                          <div class="mb-0 text-white-stable fs-6">{{ post.author }}</div>
                                       </div>
                                       <span class="text-white-stable fs-6">{{ post.published_at|date:"d.m.Y" }}</span>
                                    </div>
                                 </div>
                              </div>
                           </div>
                        </a>
                     </div>
                  {% endfor %}

                  </div>
                  <!-- Pagination controls -->

                  <nav aria-label="Page navigation" class="my-5">
                  <ul class="pagination justify-content-center">
                     {% if page_obj.has_previous %}
                        <li class="page-item">
                        <a class="page-link" href="?page={{ page_obj.previous_page_number }}" tabindex="-1">Previous</a>
                        </li>
                     {% else %}
                        <li class="page-item disabled">
                        <span class="page-link">Previous</span>
                        </li>
                     {% endif %}

                     {% for num in page_obj.paginator.page_range %}
                        {% if page_obj.number == num %}
                        <li class="page-item active">
                           <span class="page-link">{{ num }}</span>
                        </li>
                        {% else %}
                        <li class="page-item">
                           <a class="page-link" href="?page={{ num }}">{{ num }}</a>
                        </li>
                        {% endif %}
                     {% endfor %}

                     {% if page_obj.has_next %}
                        <li class="page-item">
                        <a class="page-link" href="?page={{ page_obj.next_page_number }}">Next</a>
                        </li>
                     {% else %}
                        <li class="page-item disabled">
                        <span class="page-link">Next</span>
                        </li>
                     {% endif %}
                  </ul>
                  </nav>
               </div>

               <!-- Blog Posts ENDS -->


               <!-- Newsletter -->
               <div class="col-xxl-3 col-lg-4 col-12">
                  <div class="d-flex flex-column gap-5" data-cue="fadeIn">
                     <div class="bg-primary bg-opacity-10 rounded-3 p-md-5 p-4" data-cue="zoomOut">
                        <div class="d-flex flex-column justify-content-center gap-4">
                        <form class="form-inline">
                        <div class="input-group">
                           <input class="form-control" type="search" placeholder="Search" aria-label="Search">
                           <button class="btn btn-outline-success" type="submit">
                              <span class="input-group-text bg-transparent border-0 p-0">
                                 <i class="bi bi-search fs-4 text-dark text-light" style="font-size: 1.5rem;"></i>
                              </span>
                           </button>
                        </div>
                        </form>
                           <div class="d-flex flex-column">
                              <span class="border-bottom"></span>
                           </div>
                           <div class="d-flex flex-column gap-2">
                              <h3 class="mb-0 text-primary-emphasis h4">Top Categories</h3>
                              <ul class="list-group">
                                 {% if top_categories %}
                                 {% for category in top_categories %}
                                 <li class="list-group-item d-flex justify-content-between align-items-center text-white-stable border-0 border-bottom">
                                    <a href="" class="link text-white-stable text-dark">{{ category.name }}</a> 
                                    <span class="badge badge-primary badge-pill text-white-stable text-dark">{{ category.post_count }}</span>
                                 </li>
                                 {% endfor %}
                                 {% else %}
                                    <li class="list-group-item d-flex justify-content-between align-items-center text-white-stable">
                                    <a href="" class="link text-warning">- No Category -</a> 
                                    <span class="badge badge-primary badge-pill text-white-stable text-dark">0</span>
                                 </li>
                                 {% endif %}
                              </ul>
                           </div>
                        </div>
                     </div>



                     <div class="bg-success bg-opacity-10 rounded-3 p-md-5 p-4" data-cue="zoomOut">
                        <div class="d-flex flex-column gap-4">
                           <div>
                              <span class="bg-success-subtle text-success-emphasis rounded-circle icon-shape icon-xl">
                                 <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"
                                    class="bi bi-envelope" viewBox="0 0 16 16">
                                    <path
                                       d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1zm13 2.383-4.708 2.825L15 11.105zm-.034 6.876-5.64-3.471L8 9.583l-1.326-.795-5.64 3.47A1 1 0 0 0 2 13h12a1 1 0 0 0 .966-.741M1 11.105l4.708-2.897L1 5.383z" />
                                 </svg>
                              </span>
                           </div>
                           <div class="d-flex flex-column gap-2">
                              <h3 class="mb-0 text-success-emphasis h4">Subscribe Newsletter</h3>
                              <p class="mb-0 text-dark">Register now to get latest updates about the topics you
                                 interest.</p>
                           </div>
                           <form class="needs-validation" method="post" novalidate>
                              {% csrf_token %}
                              
                              <!-- Display form errors -->
                              {% if form.errors %}
                                 <div class="alert alert-danger mb-3">
                                    {% for field, errors in form.errors.items %}
                                       {% for error in errors %}
                                          <div>{{ error }}</div>
                                       {% endfor %}
                                    {% endfor %}
                                 </div>
                              {% endif %}

                              <div class="mb-3">
                                 <label for="id_email" class="form-label visually-hidden">Email</label>
                                 <input type="email" 
                                        class="form-control border-0" 
                                        id="id_email" 
                                        name="email"
                                        placeholder="email@example.com" 
                                        value="{{ form.email.value|default:'' }}"
                                        required />
                                 {% if form.email.errors %}
                                    <div class="invalid-feedback d-block">
                                       {% for error in form.email.errors %}{{ error }}{% endfor %}
                                    </div>
                                 {% endif %}
                              </div>

                              <!-- Agreement checkbox -->
                              <div class="mb-3 form-check">
                                 <input type="checkbox" 
                                        class="form-check-input" 
                                        id="id_agreement" 
                                        name="agreement"
                                        {% if form.agreement.value %}checked{% endif %}
                                        required />
                                 <label class="form-check-label small" for="id_agreement">
                                    I agree to receive newsletter updates
                                 </label>
                                 {% if form.agreement.errors %}
                                    <div class="invalid-feedback d-block">
                                       {% for error in form.agreement.errors %}{{ error }}{% endfor %}
                                    </div>
                                 {% endif %}
                              </div>

                              <div class="d-grid">
                                 <button class="btn btn-success" type="submit">Sign Up</button>
                              </div>
                           </form>
                        </div>
                     </div>



                  </div>
               </div>
               <!-- Newsletter ENDS-->

            </div>
         </div>
      </section>

   </main>
{% endblock %}